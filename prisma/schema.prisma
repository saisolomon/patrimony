generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
}

model User {
  id               String    @id @default(uuid())
  clerkUserId      String    @unique @map("clerk_user_id")
  email            String
  name             String?
  stripeCustomerId String?   @unique @map("stripe_customer_id")
  onboardingGoal   String?   @map("onboarding_goal")
  netWorthRange    String?   @map("net_worth_range")
  institutionCount String?   @map("institution_count")
  entityCount      String?   @map("entity_count")
  primaryConcern   String?   @map("primary_concern")
  weeklyDigest     Boolean   @default(true) @map("weekly_digest")
  insightAlerts    Boolean   @default(true) @map("insight_alerts")
  taxAlerts        Boolean   @default(true) @map("tax_alerts")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  subscription Subscription?
  entities     Entity[]
  assets       Asset[]
  insights     Insight[]

  @@map("users")
}

model Subscription {
  id                   String    @id @default(uuid())
  userId               String    @unique @map("user_id")
  stripeSubscriptionId String    @unique @map("stripe_subscription_id")
  plan                 String
  billingInterval      String    @map("billing_interval")
  status               String
  trialEnd             DateTime? @map("trial_end")
  currentPeriodEnd     DateTime? @map("current_period_end")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Entity {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  parentId     String?  @map("parent_id")
  name         String
  type         String
  jurisdiction String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent   Entity?  @relation("EntityHierarchy", fields: [parentId], references: [id])
  children Entity[] @relation("EntityHierarchy")
  assets   Asset[]

  @@map("entities")
}

model Asset {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  entityId    String?  @map("entity_id")
  name        String
  category    String
  value       BigInt
  currency    String   @default("USD")
  change24h   Decimal? @map("change_24h")
  change30d   Decimal? @map("change_30d")
  institution String?
  accountMask String?  @map("account_mask")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  entity Entity? @relation(fields: [entityId], references: [id])

  @@map("assets")
}

model Insight {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  title       String
  description String
  category    String
  priority    String
  isRead      Boolean  @default(false) @map("is_read")
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("insights")
}
